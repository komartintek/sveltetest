import{t as N,a as w}from"../chunks/i4SAYe-U.js";import{i as be}from"../chunks/CS5ISnyU.js";import{h as $,d as qe,b as Ce,o as i,a6 as Ae,r as He,e as De,f as pe,s as oe,g as se,k as Q,a0 as Fe,i as Ie,j as Se,p as Be,a4 as Ee,Y as Ge,m as z,a7 as he,a8 as ie,Q as me,a9 as de,aa as ge,ab as Ve,a3 as Ye,ac as ze,D as Je,ad as _e,ae as Ue,_ as Xe,O as We,N as je,af as Te,X as Qe,ag as Ze,ah as ea,ai as aa,aj as ra,ak as ta,a as na,al as la,am as xe,an as oa,G as we,ao as Ne,ap as Le,M as I,F as ne,J as Me,v as K,K as Y,L as P,I as j,aq as sa,ar as J}from"../chunks/DZVzPhGv.js";import{a as ia,l as Oe,e as ue,s as Z}from"../chunks/mH8pkYhF.js";import{i as W,s as Pe,a as Ke}from"../chunks/DOuXPHa7.js";import{w as va}from"../chunks/DgQpC51A.js";function re(e,a){return a}function fa(e,a,r,v){for(var t=[],o=a.length,f=0;f<o;f++)Ve(a[f].e,t,!0);var l=o>0&&t.length===0&&r!==null;if(l){var k=r.parentNode;Ye(k),k.append(r),v.clear(),V(e,a[0].prev,a[o-1].next)}ze(t,()=>{for(var b=0;b<o;b++){var h=a[b];l||(v.delete(h.k),V(e,h.prev,h.next)),Je(h.e,!l)}})}function te(e,a,r,v,t,o=null){var f=e,l={flags:a,items:new Map,first:null},k=(a&Te)!==0;if(k){var b=e;f=$?oe(We(b)):b.appendChild(je())}$&&qe();var h=null,R=!1,u=Ae(()=>{var p=r();return Ge(p)?p:p==null?[]:Ee(p)});Ce(()=>{var p=i(u),n=p.length;if(R&&n===0)return;R=n===0;let m=!1;if($){var y=He(f)===De;y!==(n===0)&&(f=pe(),oe(f),se(!1),m=!0)}if($){for(var S=null,g,c=0;c<n;c++){if(Q.nodeType===8&&Q.data===Fe){f=Q,m=!0,se(!1);break}var s=p[c],d=v(s,c);g=Re(Q,l,S,null,s,d,c,t,a,r),l.items.set(d,g),S=g}n>0&&oe(pe())}$||ua(p,l,f,t,a,v,r),o!==null&&(n===0?h?Ie(h):h=Se(()=>o(f)):h!==null&&Be(h,()=>{h=null})),m&&se(!0),i(u)}),$&&(f=Q)}function ua(e,a,r,v,t,o,f){var D,F,B,_;var l=(t&Ze)!==0,k=(t&(_e|de))!==0,b=e.length,h=a.items,R=a.first,u=R,p,n=null,m,y=[],S=[],g,c,s,d;if(l)for(d=0;d<b;d+=1)g=e[d],c=o(g,d),s=h.get(c),s!==void 0&&((D=s.a)==null||D.measure(),(m??(m=new Set)).add(s));for(d=0;d<b;d+=1){if(g=e[d],c=o(g,d),s=h.get(c),s===void 0){var L=u?u.e.nodes_start:r;n=Re(L,a,n,n===null?a.first:n.next,g,c,d,v,t,f),h.set(c,n),y=[],S=[],u=n.next;continue}if(k&&ca(s,g,d,t),(s.e.f&ie)!==0&&(Ie(s.e),l&&((F=s.a)==null||F.unfix(),(m??(m=new Set)).delete(s))),s!==u){if(p!==void 0&&p.has(s)){if(y.length<S.length){var M=S[0],A;n=M.prev;var C=y[0],T=y[y.length-1];for(A=0;A<y.length;A+=1)ye(y[A],M,r);for(A=0;A<S.length;A+=1)p.delete(S[A]);V(a,C.prev,T.next),V(a,n,C),V(a,T,M),u=M,n=T,d-=1,y=[],S=[]}else p.delete(s),ye(s,u,r),V(a,s.prev,s.next),V(a,s,n===null?a.first:n.next),V(a,n,s),n=s;continue}for(y=[],S=[];u!==null&&u.k!==c;)(u.e.f&ie)===0&&(p??(p=new Set)).add(u),S.push(u),u=u.next;if(u===null)continue;s=u}y.push(s),n=s,u=s.next}if(u!==null||p!==void 0){for(var E=p===void 0?[]:Ee(p);u!==null;)(u.e.f&ie)===0&&E.push(u),u=u.next;var O=E.length;if(O>0){var H=(t&Te)!==0&&b===0?r:null;if(l){for(d=0;d<O;d+=1)(B=E[d].a)==null||B.measure();for(d=0;d<O;d+=1)(_=E[d].a)==null||_.fix()}fa(a,E,H,h)}}l&&Qe(()=>{var x;if(m!==void 0)for(s of m)(x=s.a)==null||x.apply()}),me.first=a.first&&a.first.e,me.last=n&&n.e}function ca(e,a,r,v){(v&_e)!==0&&ge(e.v,a),(v&de)!==0?ge(e.i,r):e.i=r}function Re(e,a,r,v,t,o,f,l,k,b){var h=(k&_e)!==0,R=(k&Ue)===0,u=h?R?z(t):he(t):t,p=(k&de)===0?f:he(f),n={i:p,v:u,k:o,a:null,e:null,prev:r,next:v};try{return n.e=Se(()=>l(e,u,p,b),$),n.e.prev=r&&r.e,n.e.next=v&&v.e,r===null?a.first=n:(r.next=n,r.e.next=n.e),v!==null&&(v.prev=n,v.e.prev=n.e),n}finally{}}function ye(e,a,r){for(var v=e.next?e.next.e.nodes_start:r,t=a?a.e.nodes_start:r,o=e.e.nodes_start;o!==v;){var f=Xe(o);t.before(o),o=f}}function V(e,a,r){a===null?e.first=r:(a.next=r,a.e.next=r&&r.e),r!==null&&(r.prev=a,r.e.prev=a&&a.e)}const da=Symbol("is custom element"),_a=Symbol("is html");function U(e){if($){var a=!1,r=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var v=e.value;ke(e,"value",null),e.value=v}if(e.hasAttribute("checked")){var t=e.checked;ke(e,"checked",null),e.checked=t}}};e.__on_r=r,ea(r),ia()}}function ke(e,a,r,v){var t=pa(e);$&&(t[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||t[a]!==(t[a]=r)&&(a==="loading"&&(e[aa]=r),e.removeAttribute(a))}function pa(e){return e.__attributes??(e.__attributes={[da]:e.nodeName.includes("-"),[_a]:e.namespaceURI===ra})}function X(e,a,r=a){var v=ta();Oe(e,"input",t=>{var o=t?e.defaultValue:e.value;if(o=ve(e)?fe(o):o,r(o),v&&o!==(o=a())){var f=e.selectionStart,l=e.selectionEnd;e.value=o??"",l!==null&&(e.selectionStart=f,e.selectionEnd=Math.min(l,e.value.length))}}),($&&e.defaultValue!==e.value||na(a)==null&&e.value)&&r(ve(e)?fe(e.value):e.value),la(()=>{var t=a();ve(e)&&t===fe(e.value)||e.type==="date"&&!t&&!e.value||t!==e.value&&(e.value=t??"")})}function ve(e){var a=e.type;return a==="number"||a==="range"}function fe(e){return e===""?null:+e}function $e(e,a,r){if(e.multiple)return ga(e,a);for(var v of e.options){var t=ee(v);if(oa(t,a)){v.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function ha(e,a){xe(()=>{var r=new MutationObserver(()=>{var v=e.__value;$e(e,v)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function ma(e,a,r=a){var v=!0;Oe(e,"change",t=>{var o=t?"[selected]":":checked",f;if(e.multiple)f=[].map.call(e.querySelectorAll(o),ee);else{var l=e.querySelector(o)??e.querySelector("option:not([disabled])");f=l&&ee(l)}r(f)}),xe(()=>{var t=a();if($e(e,t,v),v&&t===void 0){var o=e.querySelector(":checked");o!==null&&(t=ee(o),r(t))}e.__value=t,v=!1}),ha(e)}function ga(e,a){for(var r of e.options)r.selected=~a.indexOf(ee(r))}function ee(e){return"__value"in e?e.__value:e.value}const ce="https://script.google.com/macros/s/AKfycbzqo_pcvWWD9L9XG5yEP9Bz33lHKRzA2q5tvS6aGTRoe03z6S3akp1FsN57wOtGYxqy/exec",ya=localStorage.getItem("api_key"),ae=va(ya);ae.subscribe(e=>{localStorage.setItem("api_key",e||"")});var ka=N("<p>API-nyckel saknas.</p> <button>Ange API-nyckel</button>",1),ba=N("<p>Laddar lagersaldo...</p>"),Aa=N('<p style="color: red;"> </p>'),Ia=N("<th> </th>"),Sa=N("<td> </td>"),Ea=N("<tr></tr>"),Ta=N("<table><thead><tr></tr></thead><tbody></tbody></table>"),xa=N("<p>Inget saldo tillgängligt.</p>"),wa=N("<h2>Lagersaldo</h2> <!>",1);function Na(e,a){we(a,!1);const[r,v]=Pe(),t=()=>Ke(ae,"$apiKey",r);let o=z([]),f=z(!1),l=z(null);async function k(){console.log("fetchSaldo() anropad"),K(f,!0),K(l,null);try{console.log("Hämtar lagersaldo med nyckel:",t());const n=await fetch(`${ce}?key=${t()}&action=lagersaldo`);if(console.log("Svar från lagersaldo-API:",n),!n.ok)throw new Error(`Fel vid hämtning: ${n.status}`);const m=await n.json();console.log("JSON-data från lagersaldo-API:",m),K(o,Array.isArray(m.saldo)?m.saldo:[])}catch(n){console.error("Fel vid hämtning av lagersaldo:",n),K(l,n.message)}finally{K(f,!1)}}function b(){const n=prompt("Ange din API-nyckel:");n&&ae.set(n)}Ne(()=>t(),()=>{t()&&(console.log("Reaktivt: $apiKey ändrades, nu:",t()),k())}),Le(),be();var h=wa(),R=I(ne(h),2);{var u=n=>{var m=ka(),y=I(ne(m),2);ue("click",y,b),w(n,m)},p=(n,m)=>{{var y=g=>{var c=ba();w(g,c)},S=(g,c)=>{{var s=L=>{var M=Aa(),A=Y(M,!0);P(M),j(()=>Z(A,i(l))),w(L,M)},d=(L,M)=>{{var A=T=>{var E=Ta(),O=Y(E),H=Y(O);te(H,5,()=>Object.keys(i(o)[0]),re,(F,B)=>{var _=Ia(),x=Y(_,!0);P(_),j(()=>Z(x,i(B))),w(F,_)}),P(H),P(O);var D=I(O);te(D,5,()=>i(o),re,(F,B)=>{var _=Ea();te(_,5,()=>Object.values(i(B)),re,(x,q)=>{var G=Sa(),le=Y(G,!0);P(G),j(()=>Z(le,i(q))),w(x,G)}),P(_),w(F,_)}),P(D),P(E),w(T,E)},C=T=>{var E=xa();w(T,E)};W(L,T=>{Array.isArray(i(o))&&i(o).length>0?T(A):T(C,!1)},M)}};W(g,L=>{i(l)?L(s):L(d,!1)},c)}};W(n,g=>{i(f)?g(y):g(S,!1)},m)}};W(R,n=>{t()?n(p,!1):n(u)})}w(e,h),Me(),v()}var La=N("<option> </option>"),Ma=N("<pre> </pre>"),Oa=N('<select><option disabled selected>Välj material</option><!></select> <input type="number" placeholder="Antal"> <input type="date"> <input type="date"> <h3>Ansvarig</h3> <input placeholder="Namn"> <input placeholder="E-post"> <input placeholder="Telefonnummer"> <button>Skicka bokning</button> <!>',1),Pa=N("<p>Laddar material eller saknar API-nyckel...</p>"),Ka=N('<h1>Boka material</h1> <input placeholder="Ange API-nyckel"> <button>Spara nyckel</button> <!> <!>',1);function Fa(e,a){we(a,!1);const[r,v]=Pe(),t=()=>Ke(ae,"$apiKey",r);let o=z([]),f=z(null),l=z({materialId:"",antal:1,från:"",till:"",ansvarig:{namn:"",epost:"",telefonnummer:""}}),k=z(t()||"");async function b(){try{console.log("Hämtar material med nyckel:",t());const s=await(await fetch(`${ce}?key=${t()}&action=material`)).json();console.log("API-svar material:",s),K(o,Array.isArray(s.material)?s.material:[])}catch(c){console.error("Fel vid hämtning av material:",c),K(o,[])}}function h(){console.log("Sparar API-nyckel:",i(k)),ae.set(i(k)),b()}async function R(){K(f,null);try{console.log("Skickar bokning:",i(l));const s=await(await fetch(`${ce}?key=${t()}`,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(i(l))})).json();console.log("API-svar bokning:",s),K(f,s)}catch(c){console.error("Fel vid bokning:",c),K(f,{error:c.message})}}Ne(()=>t(),()=>{t()&&b()}),Le(),be();var u=Ka(),p=I(ne(u),2);U(p);var n=I(p,2),m=I(n,2);{var y=c=>{var s=Oa(),d=ne(s);j(()=>{i(l),sa(()=>{i(o)})});var L=Y(d);L.value=L.__value="";var M=I(L);te(M,1,()=>i(o),re,(_,x)=>{var q=La(),G={},le=Y(q,!0);P(q),j(()=>{G!==(G=i(x).MaterialId)&&(q.value=(q.__value=i(x).MaterialId)??""),Z(le,i(x).Namn)}),w(_,q)}),P(d);var A=I(d,2);U(A);var C=I(A,2);U(C);var T=I(C,2);U(T);var E=I(T,4);U(E);var O=I(E,2);U(O);var H=I(O,2);U(H);var D=I(H,2),F=I(D,2);{var B=_=>{var x=Ma(),q=Y(x,!0);P(x),j(G=>Z(q,G),[()=>JSON.stringify(i(f),null,2)],Ae),w(_,x)};W(F,_=>{i(f)&&_(B)})}ma(d,()=>i(l).materialId,_=>J(l,i(l).materialId=_)),X(A,()=>i(l).antal,_=>J(l,i(l).antal=_)),X(C,()=>i(l).från,_=>J(l,i(l).från=_)),X(T,()=>i(l).till,_=>J(l,i(l).till=_)),X(E,()=>i(l).ansvarig.namn,_=>J(l,i(l).ansvarig.namn=_)),X(O,()=>i(l).ansvarig.epost,_=>J(l,i(l).ansvarig.epost=_)),X(H,()=>i(l).ansvarig.telefonnummer,_=>J(l,i(l).ansvarig.telefonnummer=_)),ue("click",D,R),w(c,s)},S=c=>{var s=Pa();w(c,s)};W(m,c=>{Array.isArray(i(o))&&i(o).length>0?c(y):c(S,!1)})}var g=I(m,2);Na(g,{}),X(p,()=>i(k),c=>K(k,c)),ue("click",n,h),w(e,u),Me(),v()}export{Fa as component};
