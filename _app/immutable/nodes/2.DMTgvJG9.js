import{t as N,a as M}from"../chunks/i4SAYe-U.js";import{i as Ie}from"../chunks/CS5ISnyU.js";import{h as H,d as Fe,b as Be,o as s,a6 as Se,r as Ge,e as Ve,f as me,s as se,g as ve,k as Z,a0 as Ye,i as Ee,j as xe,p as ze,a4 as Te,Y as Je,m as G,a7 as ge,a8 as fe,Q as ye,a9 as pe,aa as ke,ab as Ue,a3 as Xe,ac as We,D as je,ad as he,ae as Qe,_ as Ze,O as ea,N as aa,af as Me,X as ra,ag as ta,ah as na,ai as la,aj as oa,ak as ia,a as sa,al as va,am as Ne,an as fa,G as we,ao as Le,ap as Oe,M as b,F as ne,J as Pe,v as $,K as R,L as P,I as X,aq as ua,ar as z}from"../chunks/DZVzPhGv.js";import{a as ca,l as Ke,e as de,s as j}from"../chunks/mH8pkYhF.js";import{i as Q,s as Re,a as $e}from"../chunks/DOuXPHa7.js";import{w as da}from"../chunks/DgQpC51A.js";function re(e,a){return a}function _a(e,a,r,v){for(var t=[],o=a.length,f=0;f<o;f++)Ue(a[f].e,t,!0);var l=o>0&&t.length===0&&r!==null;if(l){var A=r.parentNode;Xe(A),A.append(r),v.clear(),B(e,a[0].prev,a[o-1].next)}We(t,()=>{for(var I=0;I<o;I++){var h=a[I];l||(v.delete(h.k),B(e,h.prev,h.next)),je(h.e,!l)}})}function te(e,a,r,v,t,o=null){var f=e,l={flags:a,items:new Map,first:null},A=(a&Me)!==0;if(A){var I=e;f=H?se(ea(I)):I.appendChild(aa())}H&&Fe();var h=null,q=!1,u=Se(()=>{var p=r();return Je(p)?p:p==null?[]:Te(p)});Be(()=>{var p=s(u),n=p.length;if(q&&n===0)return;q=n===0;let m=!1;if(H){var y=Ge(f)===Ve;y!==(n===0)&&(f=me(),se(f),ve(!1),m=!0)}if(H){for(var E=null,g,c=0;c<n;c++){if(Z.nodeType===8&&Z.data===Ye){f=Z,m=!0,ve(!1);break}var i=p[c],d=v(i,c);g=qe(Z,l,E,null,i,d,c,t,a,r),l.items.set(d,g),E=g}n>0&&se(me())}H||pa(p,l,f,t,a,v,r),o!==null&&(n===0?h?Ee(h):h=xe(()=>o(f)):h!==null&&ze(h,()=>{h=null})),m&&ve(!0),s(u)}),H&&(f=Z)}function pa(e,a,r,v,t,o,f){var V,Y,C,_;var l=(t&ta)!==0,A=(t&(he|pe))!==0,I=e.length,h=a.items,q=a.first,u=q,p,n=null,m,y=[],E=[],g,c,i,d;if(l)for(d=0;d<I;d+=1)g=e[d],c=o(g,d),i=h.get(c),i!==void 0&&((V=i.a)==null||V.measure(),(m??(m=new Set)).add(i));for(d=0;d<I;d+=1){if(g=e[d],c=o(g,d),i=h.get(c),i===void 0){var L=u?u.e.nodes_start:r;n=qe(L,a,n,n===null?a.first:n.next,g,c,d,v,t,f),h.set(c,n),y=[],E=[],u=n.next;continue}if(A&&ha(i,g,d,t),(i.e.f&fe)!==0&&(Ee(i.e),l&&((Y=i.a)==null||Y.unfix(),(m??(m=new Set)).delete(i))),i!==u){if(p!==void 0&&p.has(i)){if(y.length<E.length){var O=E[0],S;n=O.prev;var D=y[0],T=y[y.length-1];for(S=0;S<y.length;S+=1)be(y[S],O,r);for(S=0;S<E.length;S+=1)p.delete(E[S]);B(a,D.prev,T.next),B(a,n,D),B(a,T,O),u=O,n=T,d-=1,y=[],E=[]}else p.delete(i),be(i,u,r),B(a,i.prev,i.next),B(a,i,n===null?a.first:n.next),B(a,n,i),n=i;continue}for(y=[],E=[];u!==null&&u.k!==c;)(u.e.f&fe)===0&&(p??(p=new Set)).add(u),E.push(u),u=u.next;if(u===null)continue;i=u}y.push(i),n=i,u=i.next}if(u!==null||p!==void 0){for(var x=p===void 0?[]:Te(p);u!==null;)(u.e.f&fe)===0&&x.push(u),u=u.next;var K=x.length;if(K>0){var F=(t&Me)!==0&&I===0?r:null;if(l){for(d=0;d<K;d+=1)(C=x[d].a)==null||C.measure();for(d=0;d<K;d+=1)(_=x[d].a)==null||_.fix()}_a(a,x,F,h)}}l&&ra(()=>{var k;if(m!==void 0)for(i of m)(k=i.a)==null||k.apply()}),ye.first=a.first&&a.first.e,ye.last=n&&n.e}function ha(e,a,r,v){(v&he)!==0&&ke(e.v,a),(v&pe)!==0?ke(e.i,r):e.i=r}function qe(e,a,r,v,t,o,f,l,A,I){var h=(A&he)!==0,q=(A&Qe)===0,u=h?q?G(t):ge(t):t,p=(A&pe)===0?f:ge(f),n={i:p,v:u,k:o,a:null,e:null,prev:r,next:v};try{return n.e=xe(()=>l(e,u,p,I),H),n.e.prev=r&&r.e,n.e.next=v&&v.e,r===null?a.first=n:(r.next=n,r.e.next=n.e),v!==null&&(v.prev=n,v.e.prev=n.e),n}finally{}}function be(e,a,r){for(var v=e.next?e.next.e.nodes_start:r,t=a?a.e.nodes_start:r,o=e.e.nodes_start;o!==v;){var f=Ze(o);t.before(o),o=f}}function B(e,a,r){a===null?e.first=r:(a.next=r,a.e.next=r&&r.e),r!==null&&(r.prev=a,r.e.prev=a&&a.e)}const ma=Symbol("is custom element"),ga=Symbol("is html");function J(e){if(H){var a=!1,r=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var v=e.value;Ae(e,"value",null),e.value=v}if(e.hasAttribute("checked")){var t=e.checked;Ae(e,"checked",null),e.checked=t}}};e.__on_r=r,na(r),ca()}}function Ae(e,a,r,v){var t=ya(e);H&&(t[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||t[a]!==(t[a]=r)&&(a==="loading"&&(e[la]=r),e.removeAttribute(a))}function ya(e){return e.__attributes??(e.__attributes={[ma]:e.nodeName.includes("-"),[ga]:e.namespaceURI===oa})}function U(e,a,r=a){var v=ia();Ke(e,"input",t=>{var o=t?e.defaultValue:e.value;if(o=ue(e)?ce(o):o,r(o),v&&o!==(o=a())){var f=e.selectionStart,l=e.selectionEnd;e.value=o??"",l!==null&&(e.selectionStart=f,e.selectionEnd=Math.min(l,e.value.length))}}),(H&&e.defaultValue!==e.value||sa(a)==null&&e.value)&&r(ue(e)?ce(e.value):e.value),va(()=>{var t=a();ue(e)&&t===ce(e.value)||e.type==="date"&&!t&&!e.value||t!==e.value&&(e.value=t??"")})}function ue(e){var a=e.type;return a==="number"||a==="range"}function ce(e){return e===""?null:+e}function Ce(e,a,r){if(e.multiple)return Aa(e,a);for(var v of e.options){var t=ee(v);if(fa(t,a)){v.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function ka(e,a){Ne(()=>{var r=new MutationObserver(()=>{var v=e.__value;Ce(e,v)});return r.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function ba(e,a,r=a){var v=!0;Ke(e,"change",t=>{var o=t?"[selected]":":checked",f;if(e.multiple)f=[].map.call(e.querySelectorAll(o),ee);else{var l=e.querySelector(o)??e.querySelector("option:not([disabled])");f=l&&ee(l)}r(f)}),Ne(()=>{var t=a();if(Ce(e,t,v),v&&t===void 0){var o=e.querySelector(":checked");o!==null&&(t=ee(o),r(t))}e.__value=t,v=!1}),ka(e)}function Aa(e,a){for(var r of e.options)r.selected=~a.indexOf(ee(r))}function ee(e){return"__value"in e?e.__value:e.value}const _e="https://script.google.com/macros/s/AKfycbzqo_pcvWWD9L9XG5yEP9Bz33lHKRzA2q5tvS6aGTRoe03z6S3akp1FsN57wOtGYxqy/exec",Ia=localStorage.getItem("api_key"),ae=da(Ia);ae.subscribe(e=>{localStorage.setItem("api_key",e||"")});var Sa=N("<p>API-nyckel saknas.</p> <button>Ange API-nyckel</button>",1),Ea=N("<p>Laddar lagersaldo...</p>"),xa=N('<p style="color: red;"> </p>'),Ta=N("<th> </th>"),Ma=N("<td> </td>"),Na=N("<tr><td> </td><!></tr>"),wa=N("<table><thead><tr><th>Material</th><!></tr></thead><tbody></tbody></table>"),La=N("<p>Inget saldo tillgängligt.</p>"),Oa=N("<h2>Lagersaldo</h2> <!>",1);function Pa(e,a){we(a,!1);const[r,v]=Re(),t=()=>$e(ae,"$apiKey",r);let o=G([]),f=G(!1),l=G(null);async function A(){console.log("fetchSaldo() anropad"),$(f,!0),$(l,null);try{console.log("Hämtar lagersaldo med nyckel:",t());const n=await fetch(`${_e}?key=${t()}&action=lagersaldo`);if(console.log("Svar från lagersaldo-API:",n),!n.ok)throw new Error(`Fel vid hämtning: ${n.status}`);const m=await n.json();console.log("JSON-data från lagersaldo-API:",m),$(o,Array.isArray(m.saldo)?m.saldo:[])}catch(n){console.error("Fel vid hämtning av lagersaldo:",n),$(l,n.message)}finally{$(f,!1)}}function I(){const n=prompt("Ange din API-nyckel:");n&&ae.set(n)}Le(()=>t(),()=>{t()&&(console.log("Reaktivt: $apiKey ändrades, nu:",t()),A())}),Oe(),Ie();var h=Oa(),q=b(ne(h),2);{var u=n=>{var m=Sa(),y=b(ne(m),2);de("click",y,I),M(n,m)},p=(n,m)=>{{var y=g=>{var c=Ea();M(g,c)},E=(g,c)=>{{var i=L=>{var O=xa(),S=R(O,!0);P(O),X(()=>j(S,s(l))),M(L,O)},d=(L,O)=>{{var S=T=>{var x=wa(),K=R(x),F=R(K),V=b(R(F));te(V,1,()=>Object.keys(s(o)[0]).filter(C=>C!=="Material"),re,(C,_)=>{var k=Ta(),w=R(k,!0);P(k),X(()=>j(w,s(_))),M(C,k)}),P(F),P(K);var Y=b(K);te(Y,5,()=>s(o),re,(C,_)=>{var k=Na(),w=R(k),W=R(w,!0);P(w);var le=b(w);te(le,1,()=>Object.keys(s(_)).filter(oe=>oe!=="Material"),re,(oe,He)=>{var ie=Ma(),De=R(ie,!0);P(ie),X(()=>j(De,s(_)[s(He)])),M(oe,ie)}),P(k),X(()=>j(W,s(_).Material)),M(C,k)}),P(Y),P(x),M(T,x)},D=T=>{var x=La();M(T,x)};Q(L,T=>{Array.isArray(s(o))&&s(o).length>0?T(S):T(D,!1)},O)}};Q(g,L=>{s(l)?L(i):L(d,!1)},c)}};Q(n,g=>{s(f)?g(y):g(E,!1)},m)}};Q(q,n=>{t()?n(p,!1):n(u)})}M(e,h),Pe(),v()}var Ka=N("<option> </option>"),Ra=N("<pre> </pre>"),$a=N('<select><option disabled selected>Välj material</option><!></select> <input type="number" placeholder="Antal"> <input type="date"> <input type="date"> <h3>Ansvarig</h3> <input placeholder="Namn"> <input placeholder="E-post"> <input placeholder="Telefonnummer"> <button>Skicka bokning</button> <!>',1),qa=N("<p>Laddar material eller saknar API-nyckel...</p>"),Ca=N('<h1>Boka material</h1> <input placeholder="Ange API-nyckel"> <button>Spara nyckel</button> <!> <!>',1);function Ya(e,a){we(a,!1);const[r,v]=Re(),t=()=>$e(ae,"$apiKey",r);let o=G([]),f=G(null),l=G({materialId:"",antal:1,från:"",till:"",ansvarig:{namn:"",epost:"",telefonnummer:""}}),A=G(t()||"");async function I(){try{console.log("Hämtar material med nyckel:",t());const i=await(await fetch(`${_e}?key=${t()}&action=material`)).json();console.log("API-svar material:",i),$(o,Array.isArray(i.material)?i.material:[])}catch(c){console.error("Fel vid hämtning av material:",c),$(o,[])}}function h(){console.log("Sparar API-nyckel:",s(A)),ae.set(s(A)),I()}async function q(){$(f,null);try{console.log("Skickar bokning:",s(l));const i=await(await fetch(`${_e}?key=${t()}`,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(s(l))})).json();console.log("API-svar bokning:",i),$(f,i)}catch(c){console.error("Fel vid bokning:",c),$(f,{error:c.message})}}Le(()=>t(),()=>{t()&&I()}),Oe(),Ie();var u=Ca(),p=b(ne(u),2);J(p);var n=b(p,2),m=b(n,2);{var y=c=>{var i=$a(),d=ne(i);X(()=>{s(l),ua(()=>{s(o)})});var L=R(d);L.value=L.__value="";var O=b(L);te(O,1,()=>s(o),re,(_,k)=>{var w=Ka(),W={},le=R(w,!0);P(w),X(()=>{W!==(W=s(k).MaterialId)&&(w.value=(w.__value=s(k).MaterialId)??""),j(le,s(k).Namn)}),M(_,w)}),P(d);var S=b(d,2);J(S);var D=b(S,2);J(D);var T=b(D,2);J(T);var x=b(T,4);J(x);var K=b(x,2);J(K);var F=b(K,2);J(F);var V=b(F,2),Y=b(V,2);{var C=_=>{var k=Ra(),w=R(k,!0);P(k),X(W=>j(w,W),[()=>JSON.stringify(s(f),null,2)],Se),M(_,k)};Q(Y,_=>{s(f)&&_(C)})}ba(d,()=>s(l).materialId,_=>z(l,s(l).materialId=_)),U(S,()=>s(l).antal,_=>z(l,s(l).antal=_)),U(D,()=>s(l).från,_=>z(l,s(l).från=_)),U(T,()=>s(l).till,_=>z(l,s(l).till=_)),U(x,()=>s(l).ansvarig.namn,_=>z(l,s(l).ansvarig.namn=_)),U(K,()=>s(l).ansvarig.epost,_=>z(l,s(l).ansvarig.epost=_)),U(F,()=>s(l).ansvarig.telefonnummer,_=>z(l,s(l).ansvarig.telefonnummer=_)),de("click",V,q),M(c,i)},E=c=>{var i=qa();M(c,i)};Q(m,c=>{Array.isArray(s(o))&&s(o).length>0?c(y):c(E,!1)})}var g=b(m,2);Pa(g,{}),U(p,()=>s(A),c=>$(A,c)),de("click",n,h),M(e,u),Pe(),v()}export{Ya as component};
